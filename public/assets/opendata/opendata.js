(function(){$(function(){var e,t,n;return Opendata.render(),n=location.pathname+"/",$("#navi .main-menu a, #navi .sub-menu a").each(function(){var e;return e=$(this),0===n.indexOf(e.attr("href"))?e.addClass("current"):void 0}),$(window).width()>=800&&(t=$(".pulldown-menu"),e=t.find("a"),t.each(function(){return e.not(".current").hide(),e.filter(".current").prependTo(t).click(function(){return e.not(".current").slideToggle("fast"),!1})})),Opendata_Tooltips.render(),Opendata_SearchUI.render(),Opendata_ListUI.render("table.od-modal"),Opendata_HieraricalCheckbox.render()}),this.Opendata=function(){function e(){}return e.loading='<img style="vertical-align:middle" src="/assets/img/loading.gif" alt="loading.." border="0" widtth="16" height="11" />',e.render=function(e){var t;return null==e&&(e=null),e&&(t=function(){return $("#cboxLoadedContent a").each(function(){var e;return e=$(this),e.addClass("cboxElement"),e.attr("target")||e.data("target")?void 0:e.colorbox({fixed:!0,width:"90%",height:"90%",onComplete:t})})},$(e).find("a").each(function(){var e;return e=$(this),e.attr("target")||e.data("target")?void 0:e.colorbox({fixed:!0,width:"90%",height:"90%",onComplete:t})})),e=$(document),e.find("a[href^=http]").each(function(){return $(this).addClass("external")}),e.find(".ajax-box").each(function(){var e;return e=$(this),e.hasClass("cboxElement")?!0:e.attr("target")||e.data("target")?void 0:e.colorbox({fixed:!0,width:"90%",height:"90%"})})},e.ajaxForm=function(e,t){var n;return null==t&&(t={}),e=$(e),n={url:e.attr("action")+".json",dataType:"json",success:function(){},error:function(e,t){return alert(["== Error =="].concat(e.responseJSON).join("\n"))}},e.on("submit",function(e){return $(this).ajaxSubmit($.extend(n,t)),e.preventDefault()})},e.ajax=function(t,n){return null==n&&(n={}),$(t).click(function(t){var i,r;return r=$(this),i={url:r.attr("href"),beforeSend:function(){return r.html(e.loading)},success:function(){return console.log("success")},error:function(e,t){return alert("== Error ==")}},$.ajax($.extend(i,n)),t.preventDefault(),!1})},e.ajaxDelete=function(t,n){return null==n&&(n={}),$(t).click(function(t){var i,r;return confirm("\u524a\u9664\u3057\u3066\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f")?(r=$(this),i={type:"DELETE",data:"_method=delete",url:r.attr("href")+".json",dataType:"json",beforeSend:function(){return r.html(e.loading)},success:function(){return r.data("remove")?$(r.data("remove")).remove():void 0},error:function(e,t){return alert(["== Error =="].concat(e.responseJSON).join("\n"))}},$.ajax($.extend(i,n)),t.preventDefault(),!1):!1})},e.confirmUnloading=function(){return $("input[type=text],textarea,select").change(function(){return $(window).on("beforeunload",function(){return"\u5165\u529b\u3057\u305f\u30c7\u30fc\u30bf\u306f\u4fdd\u5b58\u3055\u308c\u307e\u305b\u3093\u3002"})}),$("input[type=submit]").click(function(){return $(window).off("beforeunload")})},e}(),this.Opendata_Tooltips=function(){function e(){}return e.render=function(){var e;return e=$(".tooltip"),e.click(function(e){var t,n,i,r,s;return $(".tooltip ul").hide(),n=$(this),i=n.find("ul").outerHeight(),r=n.offset(),r.top-i<0?(n.find("ul").css("bottom",-1*i-15+"px"),t="ul:after {border: 8px solid transparent; border-bottom-color:#fff; bottom:"+(i-5)+"px;}",s=$("<style>").append(document.createTextNode(t)),$(".tooltip ul style").remove(),n.find("ul").append(s)):(n.find("ul").css("bottom","18px"),t="ul:after {border: 8px solid transparent; border-top-color:#fff; bottom:-13px;}",s=$("<style>").append(document.createTextNode(t)),$(".tooltip ul style").remove(),n.find("ul").append(s)),n.find("ul").show()}),$(document).click(function(t){return e.is($(t.target).closest("div"))?void 0:$(".tooltip ul").hide()})},e}(),this.Opendata_ListUI=function(){function e(){}return e.render=function(t){return $("table.od-modal tbody tr").each(function(){var t,n;return n=$(this),t=n.parent(),n.find(".tap-menu a").each(function(){return"/delete"===$(this).attr("href").slice(-7)?n.find(".tap-menu").after("<nav class='multiple-menu'><a href='multipleDelete' >\u3059\u3079\u3066\u524a\u9664\u3059\u308b</a></nav>"):void 0}),n.find("input[type=checkbox]").each(function(){return n.toggleClass("checked",$(this).prop("checked"))}),n.find("input[type=checkbox]").change(function(){var e,t,i,r,s;for(n.toggleClass("checked",$(this).prop("checked")),t=0,s=$("input[name='ids[]']"),i=0,r=s.length;r>i;i++)e=s[i],e.checked&&t++;return $("thead input[type=checkbox]").prop("checked",t>0&&$("input[name='ids[]']").length===t),this.checked?void 0:n.find(".multiple-menu").hide()}),n.find("input[type=checkbox]").mouseover(function(e){return this.checked?n.find(".multiple-menu").css("left",e.pageX+15).css("top",e.pageY-5).show():void 0}),n.mouseup(function(e){return $(e.target).is("a")||$(e.target).is("input")?void 0:(t.find("input[type=checkbox]").attr("checked",!1),t.find("tr").removeClass("checked"),n.find(".tap-menu").css("left",e.pageX+2).css("top",e.pageY).show(),n.find("input[type=checkbox]").trigger("click"))}),n.mouseleave(function(){return n.find(".tap-menu").hide(),n.find(".multiple-menu").hide()}),n.find(".multiple-menu a").on("click",function(t){var n,i,r,s;if("multipleDelete"===$(this).attr("href")){for(t.preventDefault(),s=$("input[name='ids[]']"),i=0,r=s.length;r>i;i++)if(n=s[i],n.checked){if(200!==e.deleteitem(n.value).status)return;n.checked=!1}return location.reload()}})}),$("thead input[type=checkbox]").change(function(){var e,t,n,i,r;for(i=$("input[name='ids[]']"),r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(e.checked=this.checked);return r})},e.deleteitem=function(e){return $.ajax({type:"post",url:location.pathname+"/"+e,async:!1,data:"_method=delete",success:function(e){},error:function(e,t){return alert(["== Error =="].concat(e.statusText).join("\n"))}})},e}(),this.Opendata_SearchUI=function(){function e(){}return e.select=function(t){var n,i,r;r=$("<tr>").attr("data-id",t.id),i=$.colorbox.element().closest("dl").find(".hidden-ids").clone(!1),i=i.val(t.id).removeClass("hidden-ids"),n=$('<a class="deselect" href="#">\u524a\u9664</a>').on("click",e.deselect),r.append($("<td>").append($(i)).append(t.name)),r.append($("<td>").append($(n))),$.colorbox.element().closest("dl").find(".ajax-selected tbody").prepend(r)},e.deselect=function(e){return $(this).parents("tr:first").remove(),e.preventDefault()},e.toggleSelectButton=function(){return $("#ajax-box .items input:checkbox").filter(":checked").size()>0?$("#ajax-box .select-items").parent("div").show():$("#ajax-box .select-items").parent("div").hide()},e.render=function(){return $(".ajax-selected").each(function(){return $(this).find(".deselect").on("click",e.deselect),0===$(this).find(".deselect").size()?$(this).hide():void 0})},e.modal=function(){return $("#ajax-box form.search").on("submit",function(e){return $(this).ajaxSubmit({url:$(this).attr("action"),success:function(e){return $("#cboxLoadedContent").html(e)},error:function(e,t){return alert("== Error ==")}}),e.preventDefault()}),$.colorbox.element().closest("dl").find(".ajax-selected tr[data-id]").each(function(){var e;return e=$(this).attr("data-id"),$("#ajax-box .items [data-id="+e+"]").remove()}),Opendata_ListUI.render("table.od-modal"),$("#ajax-box a.select-item").on("click",function(t){var n,i;return n=$(this).closest("[data-id]").attr("data-id"),i=$(this).text(),e.select({id:n,name:i}),$.colorbox.element().closest("dl").find(".ajax-selected").show(),t.preventDefault(),$.colorbox.close()}),$("#ajax-box .select-items").on("click",function(t){return $("#ajax-box .items input:checkbox").filter(":checked").each(function(){var t,n;return t=$(this).closest("[data-id]").attr("data-id"),n=$(this).closest("[data-id]").find(".select-item").text(),""===n&&(n=$(this).closest("[data-id]").text()),e.select({id:t,name:n})}),$.colorbox.element().closest("dl").find(".ajax-selected").show(),t.preventDefault(),$.colorbox.close()}),$("#ajax-box .od-modal").on("change",function(t){return e.toggleSelectButton()}),e.toggleSelectButton()},e}(),this.Opendata_HieraricalCheckbox=function(){function e(){}return e.render=function(){return $("label.parent input[type='checkbox']").on("change",function(e){var t;return t=$(this).is(":checked"),$(this).closest("div.parent").find("input[type='checkbox']").prop("checked",t)})},e}()}).call(this);