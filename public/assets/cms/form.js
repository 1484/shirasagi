(function(){$(function(){return $(".mod-cms-body button.syntax-check").click(function(){var e,r,n,t,i,s,a,c,o,d;if(Syntax_Checker.reset(),r="undefined"!=typeof tinymce?"<div>"+tinymce.get("item_html").getContent()+"</div>":"undefined"!=typeof CKEDITOR?"<div>"+CKEDITOR.instances.item_html.getData()+"</div>":"<div></div>",Syntax_Checker.checkTagImg(r),Syntax_Checker.checkTable(r),i=$("<div>"),i.attr("id","errorSyntaxChecker"),i.attr("class","errorExplanation"),i.append("<h2>"+Syntax_Checker.message.header+"</h2>"),0===Object.keys(Syntax_Checker.errors).length)i.append("<p>"+Syntax_Checker.message.noErrors+"</p>");else{i.append("<p>"+Syntax_Checker.message.body+"</p>"),i.append("<ul>"),s=i.find("ul"),o=Syntax_Checker.errors;for(n in o)for(e=o[n],s.append("<li>"),s.find("li:last").append("<code>"),s.find("li:last code").text(e.code),s.append("<ul>"),d=e.msg,a=0,c=d.length;c>a;a++)t=d[a],s.find("ul:last").append("<li>"),s.find("ul li:last").text(t)}$(".mod-cms-body div#errorSyntaxChecker").remove(),$(".mod-cms-body dd:last").after(i)}),$(".mod-cms-body button.link-check").click(function(){var e,r;$.support.cors=!0,e=this,$(e).attr("disabled",!0),Link_Checker.reset(),r="undefined"!=typeof tinymce?"<div>"+tinymce.get("item_html").getContent()+"</div>":"undefined"!=typeof CKEDITOR?"<div>"+CKEDITOR.instances.item_html.getData()+"</div>":"<div></div>",Link_Checker.check(r,function(){var r,n,t,i,s;if(t=$("<div>"),t.attr("id","errorLinkChecker"),t.attr("class","errorExplanation"),t.append("<h2>"+Link_Checker.message.header+"</h2>"),""!==Link_Checker.error)t.append(Link_Checker.error);else{t.append("<p>"+Link_Checker.message.checkLinks+"</p>"),t.append("<ul>"),i=t.find("ul"),s=Link_Checker.links;for(r in s)n=s[r],i.append("<li>"),i.find("li:last").append(n)}$(".mod-cms-body div#errorLinkChecker").remove(),$(".mod-cms-body").append(t),$(e).removeAttr("disabled")})})}),this.Syntax_Checker=function(){function e(){}return e.message={header:"HTML\u30c1\u30a7\u30c3\u30af",body:"\u6b21\u306e\u9805\u76ee\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002",noErrors:"\u30a8\u30e9\u30fc\u306f\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002",notSetImgAlt:"\u753b\u50cf\u306b\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",notSetTableSummary:"\u8868\u306b\u30b5\u30de\u30ea\u5c5e\u6027\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002",notSetTableCaption:"\u8868\u306b\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"},e.errors,e.count,e.reset=function(){this.errors={},this.count=0},e.pushError=function(r,n,t){this.errors[r]?e.errors[r].msg.push(t):(e.errors[r]={},e.errors[r].code=n,e.errors[r].msg=[],e.errors[r].msg.push(t))},e.getFirstTag=function(e){var r;return r=$("<p>"),r.append($(e).clone()),r.html().match(/<.*?>/)[0].toString()},e.checkTagImg=function(r){$(r).find("img").each(function(){var r,n,t,i;r=$(this).attr("alt"),i=e.count+1,t=e.getFirstTag(this),n=!1,r&&""!==r.trim()||(e.pushError(i,t,e.message.notSetImgAlt),n=!0),n&&(e.count+=1)})},e.checkTable=function(r){$(r).find("table").each(function(){var r,n,t,i,s;s=$(this).attr("summary"),r=$(this).find("caption"),i=e.count+1,t=e.getFirstTag(this),n=!1,s&&""!==s.trim()||(e.pushError(i,t,e.message.notSetTableSummary),n=!0),r&&""!==r.text().trim()||(e.pushError(i,t,e.message.notSetTableCaption),n=!0),n&&(e.count+=1)})},e}(),this.Link_Checker=function(){function e(){}return e.message={header:"\u30ea\u30f3\u30af\u30c1\u30a7\u30c3\u30af",noLinks:"\u30ea\u30f3\u30af\u306f\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002",checkLinks:"\u6b21\u306e\u30ea\u30f3\u30af\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002",success:"\u6210\u529f",failure:"\u5931\u6557",linkCheckerError:"\u30ea\u30f3\u30af\u30c1\u30a7\u30c3\u30af\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u6b21\u306eURL\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093\u3002"},e.links={},e.error="",e.url="/.cms/link_check/check.json",e.reset=function(){this.links={},this.error=""},e.check=function(r,n){var t,i,s,a,c,o,d;if(a=$(r).find("a[href]").length,0===a)return e.error="<p>"+e.message.noLinks+"</p>",void n();for(s={},d=$(r).find("a[href]"),i=c=0,o=d.length;o>c;i=++c)t=d[i],s[i+1]=$(t).attr("href");$.ajax({type:"POST",url:e.url,cache:!1,data:JSON.stringify({url:s}),contentType:"application/json",dataType:"json",crossDomain:!0,success:function(r){var n,t,i;for(t in r)n=r[t],200===n?(i='<span class="success">'+e.message.success+"</span>",e.links[t]=t+" "+i):(i='<span class="failure">'+e.message.failure+"</span>",e.links[t]=t+" "+i)},error:function(){e.error="<p>"+e.message.linkCheckerError+": "+e.url+"</p>"},complete:function(){n()}})},e}()}).call(this);