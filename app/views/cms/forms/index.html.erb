<% @table_def ||= define_ss_table do |tbl| %>
  <% tbl.column_checkbox %>

  <% tbl.column(class: "title") do %>
    <% tbl.th t("mongoid.attributes.cms/content.name") %>
    <% tbl.td do |item| %>
      <% if @index_title %>
        <% @index_title.call item %>
      <% else %>
        <% title = item.try(:name) || item.try(:title) || item.try(:filename) || "##{item.id}" %>
        <%= link_to title, {action: :show, id: item} %>
      <% end %>
    <% end %>
  <% end %>

  <% tbl.column(class: "state") do %>
    <% tbl.th @model.t(:state) %>
    <% tbl.td do |item| %><%= t "ss.state.#{item.state}" %><% end %>
  <% end %>

  <% tbl.column_updated %>

  <% tbl.tap_menu do |item| %>
    <%= link_to(t('ss.links.show'), { action: :show, id: item }, { class: "dropdown-item" }) if item.allowed?(:read, @cur_user, site: @cur_site) %>
    <%= link_to(t('ss.links.edit'), { action: :edit, id: item }, { class: "dropdown-item" }) if item.allowed?(:edit, @cur_user, site: @cur_site) %>
    <%= link_to(t('ss.links.delete'), { action: :delete, id: item }, { class: "dropdown-item" }) if item.allowed?(:delete, @cur_user, site: @cur_site) %>
  <% end %>
<% end %>

<%= render file: 'cms/crud/index' %>
