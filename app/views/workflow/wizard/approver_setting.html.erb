<%

level = 1

if @ss_mode == :gws
  approvers_path = method(:gws_workflow_search_approvers_path)
else
  approvers_path = method(:workflow_search_approvers_path)
end

%>
<%= jquery do %>
  SS.renderAjaxBox($(".workflow-wizard"));
<% end %>

<div id="workflow-wizard" class="see workflow-wizard">
  <%= render file: "workflow/wizard/_approver_agent" %>

  <%= ss_field_tag_set("workflow_comment", @item.workflow_comment, type: :text_area, label: @model.t(:workflow_comment), tt: @model.tt(:workflow_comment), class: "form-control") %>
  <%= hidden_field_tag "workflow_required_counts", "false", id: nil %>
  <%= ss_field_tag_set("workflow_approvers", nil, label: @model.t(:workflow_approvers), tt: @model.tt(:workflow_approvers)) do %>
    <% render_template = proc do |id, user_id, name| %>
      <tr data-id="<%= id %>">
        <td>
          <%= name %>
          <%= hidden_field_tag "workflow_approvers", "#{level},#{user_id},,pending,", id: nil %>
        </td>
        <td><%= link_to t("ss.buttons.delete"), "#", class: "deselect" %></td>
      </tr>
    <% end %>

    <div class="ajax-select">
      <%= link_to t("workflow.search_approvers.index"), approvers_path.call(level: level), class: "ajax-box btn btn-outline-secondary btn-sm" %>

      <div class="table-responsive">
        <table class="index ajax-selected approvers table table-striped hide">
          <thead>
            <tr>
              <th class="name"><%= @model.t :name %></th>
              <th></th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>

      <script type="text/html" class="ajax-item-template">
        <% render_template.call("#id", "#userid", "#name") %>
      </script>
    </div>
  <% end %>
  <% if @ss_mode == :gws %>
  <dl class="see request-setting">
    <dt><%= @model.t :workflow_circulations %><%= @model.tt :workflow_circulations %></dt>
    <dd>
      <%= link_to t("workflow.search_circulations.index"), approvers_path.call(level: "circulation#{level}"), class: "btn ajax-box circulations" %>
    </dd>
    <dd>
      <table class="index ajax-selected circulations" style="display: none;">
        <thead>
          <tr>
            <th class="name"><%= @model.t :name %></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </dd>
  </dl>
  <% end %>
  <dl class="see request-setting">
    <dd>
      <div class="buttons">
        <%= button_tag t("workflow.buttons.request"), { type: :button, updatetype: :request, class: "update-item btn btn-primary" } %>
        <%= button_tag t("workflow.buttons.cancel"), { type: :reset, class: "workflow-route-cacnel btn-default" } %>
      </div>
      <div class="checkbox">
        <label>
          <% force = @cur_site.forced_update rescue nil %>
          <% if force == "enabled" %>
          <%= check_box_tag "forced-request", true, true, class: "forced" %><%= t("errors.messages.forced_update") %>
          <% else %>
          <%= check_box_tag "forced-request", true, false, class: "forced" %><%= t("errors.messages.forced_update") %>
          <% end %>
        </label>
      </div>
    </dd>
  </dl>
</div>
