<%= jquery do %>
    $(".set-seen-all").click(function(){
      var form = Gws_Circular_Post.buildForm("<%= set_seen_all_gws_circular_posts_path %>", "<%= I18n.t('gws/circular.confirm.set_seen_all') %>");
      form.appendTo(document.body).submit();
    });

    $(".unset-seen-all").click(function(){
      var form = Gws_Circular_Post.buildForm("<%= unset_seen_all_gws_circular_posts_path %>", "<%= I18n.t('gws/circular.confirm.unset_seen_all') %>");
      form.appendTo(document.body).submit();
    });

    $(".download").click(function(){
      var form = Gws_Circular_Post.buildForm("<%= download_gws_circular_posts_path %>", "<%= I18n.t('gws/circular.confirm.download') %>");
      form.appendTo(document.body).submit();
    });
<% end %>

<% @index_meta = proc do |item| %>
  <span class="id">#<%= item.id %></span>
  <span class="datetime"><%= tryb { item.due_date.strftime('%Y/%m/%d %H:%M') } %></span>
  <span class="seen">
    <% if item.member?(@cur_user) %>
      <%= item.seen?(@cur_user) ? t('gws/circular.post.seen') :  t('gws/circular.post.unseen') %>
    <% end %>
  </span>
  <span><%= item.readable_names.join(', ') %></span>
  <span class="gws-share-categories">
    <% item.categories.compact.each do |category| %>
      <%= link_to category.trailing_name, gws_circular_category_posts_path(category: category.id),
                  class: 'gws-category-label', style: category_label_css(category) %>
    <% end %>
  </span>
<% end %>

<%= jquery do %>
  $('.gws-category-navi-menu #category_id').change(function() {
    var cid = $(this).val();
    if (cid) location.href = '<%= gws_circular_category_posts_path(category: 'ID') %>'.replace('ID', cid);
    else location.href = '<%= gws_circular_posts_path %>';
  });
<% end %>

<div class="gws-category-navi-menu">
  <%= select_tag :category_id, options_for_select(@categories.to_options(offset: 1), @category.try(:id)), include_blank: t('modules.gws/circular') if  @categories.to_options.present? %>
</div>

<%= render file: 'gws/crud/index' %>
