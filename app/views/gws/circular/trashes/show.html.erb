<% addons = @item.class.addons.select { |addon| [SS::Addon::Markdown, Gws::Addon::Member].exclude?(addon.klass) } %>

<div class="gws-board gws-board-thread">
  <article class="topic">
    <header>
      <h2>
        <span class="name"><%= @item.name %></span>
        <span class="categories"></span>
      </h2>
      <nav class="meta">
        <span class="user"><%= @item.user_long_name %></span>
        <span class="datetime"><%= @item.updated.strftime("%Y/%m/%d %H:%M") %></span>
      </nav>
    </header>

    <div class="body markdown-body">
      <%= @item.html %>
    </div>

    <% if @item.files.present? %>
        <div class="files">
          <% @item.files.each do |file| %>
              <img src="/assets/img/gws/ic-file.png" alt=""/>
              <%= link_to file.humanized_name, file.url, class: "icon-#{file.extname}", target: '_blank' %>
          <% end %>
        </div>
    <% end %>
  </article>

  <div class="comments">
    <% @item.comments.each_with_index do |comment, i| %>
      <aside class="comment">
        <header>
          <h2><%= comment.name %></h2>
          <nav class="meta">
            <span class="user"><%= comment.user.long_name %></span>
            <span class="datetime"><%= comment.created.strftime('%Y/%m/%d %H:%M') %></span>
          </nav>
        </header>

        <div class="toggle-body">
          <div class="body"><pre><%= comment.text %></pre></div>
        </div>
      </aside>
    <% end %>
  </div>

  <article class="topic">
    <header>
      <h2><span class="name"><%= t('gws/circular.post.member') %></span></h2>
    </header>
    <div class="body">
      <table class="index">
        <thead>
        <tr>
          <th><%= t('gws/circular.post.type') %></th>
          <th><%= t('gws/circular.post.seen_at') %></th>
          <th><%= t('gws/circular.post.update_at') %></th>
          <th><%= t('gws/circular.post.user') %></th>
          <th><%= t('gws/circular.post.replay') %></th>
        </tr>
        </thead>
        <tbody class="items">
          <% @item.members.each do |member| %>
            <% post = @item.comments.find {|c| c.user_id == member.id } %>
            <tr>
              <td><%= @item.seen?(member) ? t('gws/circular.post.seen') :  t('gws/circular.post.unseen') %></td>
              <td><%= tryb { @item.seen_at(member).strftime('%Y/%m/%d %H:%M') } %></td>
              <td><%= post ? post.updated.strftime('%Y/%m/%d %H:%M') : '' %></td>
              <td><%= member.name %></td>
              <td><%= post ? post.text : '' %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </article>

  <%= jquery do %>
    $(".gws-addon-reminder #item_date").attr("readonly", true);
    $(".gws-addon-reminder button").hide();
  <% end %>
  <%= render file: '_addons_show', locals: { addons: addons } if addons.size > 0 %>
</div>
