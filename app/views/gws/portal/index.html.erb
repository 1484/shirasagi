<%= javascript_include_tag "/assets/js/fullcalendar/ja.js" %>

<div class="main-box portal-calendar">
  <header><h2><%= t('modules.gws_schedule') %></h2></header>

  <% @users.each do |user| %>
    <%
    calendar_id = "calendar#{user.id}"
    events = Gws::Schedule::Plan.user(user)
    %>
    <div class="calendar portal" id="<%= calendar_id %>"></div>

    <%= jquery do %>
    $('#<%= calendar_id %>').fullCalendar({
      lang: 'ja',
      defaultView: 'basicWeek',
      header: false,
      columnFormat: { month: 'ddd', week: 'M/D（ddd）', day: 'M/D（ddd）' },
      contentHeight: 'auto',
      eventSources: [{ events: <%== calendar_format(events).to_json %> }]
    });

    $('#<%= calendar_id %> .fc-head').
      after('<tbody class="fc-row-name"><tr><td><%= user.name %></td></tr></tbody>');

    <% end %>
  <% end %>
</div>

<div class="main-box porta-calendar">
  <header><h2><%= t('modules.gws_board') %></h2></header>

  <table class="index">
    <thead>
      <tr>
        <th>スレッドタイトル</th>
        <th>コメント数</th>
        <th>最終更新日時</th>
      </tr>
    </thead>

    <tbody>
      <% @boards.each do |item| %>
      <tr>
        <td class="title"><%= link_to item.name, gws_board_topic_path(id: item) %></td>
        <td class="comment"><%= item.descendants.size %></td>
        <td class="datetime"><%= item.descendants_updated.strftime("%Y-%m-%d %H:%M") %></td>
      </tr>
      <% end %>
    </tbody>
  </table>
</div>
